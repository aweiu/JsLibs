!function(a,b){"function"==typeof define&&define.amd?define("calendar",["jquery"],b):"object"==typeof exports?module.exports=b(require("jquery")):b(a.jQuery)}(this,function(a){function b(a){return"[object Date]"===B.call(a)}function c(a){return"[object String]"===B.call(a)}function d(a){return a.getAttribute("class")||a.getAttribute("className")}function e(b,c){this.$element=a(b),this.options=a.extend({},a.fn.calendar.defaults,c),this.$element.addClass("calendar "+this.options.customClass),this.width=this.options.width,this.height=this.options.height,this.date=this.options.date,this.selectedRang=this.options.selectedRang,this.data=this.options.data,this.init()}var f={width:280,height:280,zIndex:1,trigger:null,offset:[0,1],customClass:"",view:"date",date:new Date,format:"yyyy/mm/dd",startWeek:0,weekArray:["日","一","二","三","四","五","六"],selectedRang:null,data:null,label:"{d}\n{v}",prev:"&lt;",next:"&gt;",viewChange:a.noop,onSelected:function(a,b,c){},onMouseenter:a.noop,onClose:a.noop},g="data-calendar-",h="["+g+"display-date]",i="["+g+"display-month]",j="["+g+"arrow-date]",k="["+g+"arrow-month]",l=g+"day",m=g+"month",n="disabled",o="markData",p={date:"calendar-d",month:"calendar-m"},q="old",r="new",s="now",t="selected",u='<i class="dot"></i>',v='{year}/<span class="m">{month}</span>',w='style="width:{w}px;height:{h}px;line-height:{h}px"',x="<li "+w+">{wk}</li>",y="<li "+w+' class="{class}" {action}>{value}</li>',z="<li "+w+" "+m+">{m}月</li>",A=['<div class="calendar-inner">','<div class="calendar-views">','<div class="view view-date">','<div class="calendar-hd">','<a href="javascript:;" data-calendar-display-date class="calendar-display">','{yyyy}/<span class="m">{mm}</span>',"</a>",'<div class="calendar-arrow">','<span class="prev" title="上一月" data-calendar-arrow-date>{prev}</span>','<span class="next" title="下一月" data-calendar-arrow-date>{next}</span>',"</div>","</div>",'<div class="calendar-ct">','<ol class="week">{week}</ol>','<ul class="date-items"></ul>',"</div>","</div>",'<div class="view view-month">','<div class="calendar-hd">','<a href="javascript:;" data-calendar-display-month class="calendar-display">{yyyy}</a>','<div class="calendar-arrow">','<span class="prev" title="上一年" data-calendar-arrow-month>{prev}</span>','<span class="next" title="下一年" data-calendar-arrow-month>{next}</span>',"</div>","</div>",'<ol class="calendar-ct month-items">{month}</ol>',"</div>","</div>","</div>",'<div class="calendar-label"><p>HelloWorld</p><i></i></div>'],B=Object.prototype.toString;String.prototype.repeat=function(a){return this.replace(/\{\w+\}/g,function(b){var c=b.replace(/\{|\}/g,"");return a[c]||""})},String.prototype.toDate=function(){var a=new Date,b=this.replace(/\d/g,"").charAt(0),c=this.split(b);return a.setFullYear(c[0]),a.setMonth(c[1]-1),a.setDate(c[2]),a},Date.prototype.format=function(a){var b=this.getFullYear(),c=this.getMonth()+1,d=this.getDate();return a.replace("yyyy",b).replace("mm",c).replace("dd",d)},Date.prototype.isSame=function(a,c,d){if(b(a)){var e=a;a=e.getFullYear(),c=e.getMonth()+1,d=e.getDate()}return this.getFullYear()===a&&this.getMonth()+1===c&&this.getDate()===d},Date.prototype.add=function(a){this.setDate(this.getDate()+a)},Date.prototype.minus=function(a){this.setDate(this.getDate()-a)},Date.prototype.clearTime=function(a){return this.setHours(0),this.setSeconds(0),this.setMinutes(0),this.setMilliseconds(0),this},Date.isLeap=function(a){return a%100!==0&&a%4===0||a%400===0},Date.getDaysNum=function(a,b){var c=31;switch(b){case 2:c=this.isLeap(a)?29:28;break;case 4:case 6:case 9:case 11:c=30}return c},Date.getSiblingsMonth=function(a,b,c){var d=new Date(a,b-1);return d.setMonth(b-1+c),{y:d.getFullYear(),m:d.getMonth()+1}},Date.getPrevMonth=function(a,b,c){return this.getSiblingsMonth(a,b,0-(c||1))},Date.getNextMonth=function(a,b,c){return this.getSiblingsMonth(a,b,c||1)},Date.tryParse=function(a){return a?b(a)?a:a.toDate():a},e.prototype={constructor:e,getDayAction:function(a){var b=l;if(this.selectedRang){var c=Date.tryParse(this.selectedRang[0]),d=Date.tryParse(this.selectedRang[1]);(c&&a<c.clearTime()||d&&a>d.clearTime())&&(b=n)}return b},getDayData:function(a){var b,c=this.data;if(c)for(var d=0,e=c.length;e>d;d++){var f=c[d];a.isSame(f.date.toDate())&&(b=f.value)}return b},getDayItem:function(b,c,d,e){var f,g,h=this.date,i=new Date(b,c-1,d),j={w:this.width/7,h:this.height/7,value:d};h.isSame(b,c,d)?t:"";return 1===e?j["class"]=q:3===e?j["class"]=r:j["class"]="",h.isSame(b,c,d)&&(j["class"]+=" "+s),j.action=this.getDayAction(i),f=this.getDayData(i),g=a(y.repeat(j)),f&&(g.data(o,f),g.html(d+u)),g},getDaysHtml:function(c,d){var e,f,g,h,i,j,k=(this.date,a('<ol class="days"></ol>'));b(c)?(e=c.getFullYear(),f=c.getMonth()+1):(e=Number(c),f=Number(d)),g=new Date(e,f-1,1).getDay()||7,j=g-this.options.startWeek,h=Date.getDaysNum(e,f),i=Date.getPrevMonth(e,f),prevDaysNum=Date.getDaysNum(e,i.m),nextM=Date.getNextMonth(e,f);for(var l=1,m=2,n=3,o=0,p=prevDaysNum-j+1;p<=prevDaysNum;p++,o++)k.append(this.getDayItem(i.y,i.m,p,l));for(var q=1;h>=q;q++,o++)k.append(this.getDayItem(e,f,q,m));for(var r=1,s=42-o;s>=r;r++)k.append(this.getDayItem(nextM.y,nextM.m,r,n));return a("<li></li>").width(this.options.width).append(k)},getWeekHtml:function(){for(var a=[],b=this.options.weekArray,c=this.options.startWeek,d=b.length,e=this.width/7,f=this.height/7,g=c;d>g;g++)a.push(x.repeat({w:e,h:f,wk:b[g]}));for(var h=0;c>h;h++)a.push(x.repeat({w:e,h:f,wk:b[h]}));return a.join("")},getMonthHtml:function(){for(var a=[],b=this.width/4,c=this.height/4,d=1;13>d;d++)a.push(z.repeat({w:b,h:c,m:d}));return a.join("")},setMonthAction:function(a){var b=this.date.getMonth()+1;this.$monthItems.children().removeClass(s),a===this.date.getFullYear()&&this.$monthItems.children().eq(b-1).addClass(s)},fillStatic:function(){var a={prev:this.options.prev,next:this.options.next,week:this.getWeekHtml(),month:this.getMonthHtml()};this.$element.html(A.join("").repeat(a))},updateDisDate:function(a,b){this.$disDate.html(v.repeat({year:a,month:b}))},updateDisMonth:function(a){this.$disMonth.html(a)},fillDateItems:function(a,b){var c=[Date.getPrevMonth(a,b),{y:a,m:b},Date.getNextMonth(a,b)];this.$dateItems.html("");for(var d=0;3>d;d++){var e=this.getDaysHtml(c[d].y,c[d].m);this.$dateItems.append(e)}},hide:function(a,b,c){this.$trigger.val(b.format(this.options.format)),this.options.onClose.call(this,a,b,c),this.$element.hide()},trigger:function(){this.$trigger=this.options.trigger instanceof a?this.options.trigger:a(this.options.trigger);var b=this,c=b.$element,d=b.$trigger.offset(),e=b.options.offset;c.addClass("calendar-modal").css({left:d.left+e[0]+"px",top:d.top+b.$trigger.outerHeight()+e[1]+"px",zIndex:b.options.zIndex}),b.$trigger.click(function(){c.show()}),a(document).click(function(d){b.$trigger[0]==d.target||a.contains(c[0],d.target)||c.hide()})},render:function(){this.$week=this.$element.find(".week"),this.$dateItems=this.$element.find(".date-items"),this.$monthItems=this.$element.find(".month-items"),this.$label=this.$element.find(".calendar-label"),this.$disDate=this.$element.find(h),this.$disMonth=this.$element.find(i);var a=this.date.getFullYear(),b=this.date.getMonth()+1;this.updateDisDate(a,b),this.updateMonthView(a),this.fillDateItems(a,b),this.options.trigger&&this.trigger()},setView:function(a){this.$element.removeClass(p.date+" "+p.month).addClass(p[a]),this.view=a},updateDateView:function(b,c,d,e){c=c||this.date.getMonth()+1;var f=this,g=this.$dateItems,h={prev:function(){var d=Date.getPrevMonth(b,c),h=Date.getPrevMonth(b,c,2),i=f.getDaysHtml(h.y,h.m);c=d.m,b=d.y,g.animate({marginLeft:0},300,"swing",function(){g.children(":last").remove(),g.prepend(i).css("margin-left","-100%"),a.isFunction(e)&&e.call(f)})},next:function(){var d=Date.getNextMonth(b,c),h=Date.getNextMonth(b,c,2),i=f.getDaysHtml(h.y,h.m);c=d.m,b=d.y,g.animate({marginLeft:"-200%"},300,"swing",function(){g.children(":first").remove(),g.append(i).css("margin-left","-100%"),a.isFunction(e)&&e.call(f)})}};return d?h[d]():this.fillDateItems(b,c),this.updateDisDate(b,c),this.setView("date"),{y:b,m:c}},updateMonthView:function(a){this.updateDisMonth(a),this.setMonthAction(a),this.setView("month")},getDisDateValue:function(){var a=this.$disDate.html().split("/"),b=Number(a[0]),c=Number(a[1].match(/\d{1,2}/)[0]);return[b,c]},selectedDay:function(a,b){var c=this.getDisDateValue(),d=c[0],e=c[1],f=function(){this.$dateItems.children(":eq(1)").find("["+l+"]:not(."+r+", ."+q+")").removeClass(t).filter(function(b){return parseInt(this.innerHTML)===a}).addClass(t)};if(b){var g=this.updateDateView(d,e,{old:"prev","new":"next"}[b],f);d=g.y,e=g.m,this.options.viewChange("date",d,e)}else f.call(this);return new Date(d,e-1,a)},showLabel:function(a,b,c,d){var e=this.$label;e.find("p").html(this.options.label.repeat({m:b,d:c.format(this.options.format),v:d}).replace(/\n/g,"<br>"));var f=e.outerWidth(),g=e.outerHeight();e.css({left:a.pageX-f/2+"px",top:a.pageY-g-20+"px"}).show()},hasLabel:function(){return this.options.label?(a("body").append(this.$label),!0):!1},event:function(){var b=this,c=b.options.viewChange;b.$element.on("click",h,function(){var a=b.getDisDateValue();b.updateMonthView(a[0],a[1]),c("month",a[0],a[1])}).on("click",i,function(){var a=this.innerHTML;b.updateDateView(a),c("date",a)}),b.$element.on("click",j,function(){var a=b.getDisDateValue(),e=d(this),f=a[0],g=a[1],h=b.updateDateView(f,g,e,function(){c("date",h.y,h.m)})}).on("click",k,function(){var a=Number(b.$disMonth.html()),e=d(this);a="prev"===e?a-1:a+1,b.updateMonthView(a),c("month",a)}),b.$element.on("click","["+l+"]",function(){var c=parseInt(this.innerHTML),e=d(this),f=/new|old/.test(e)?e.match(/new|old/)[0]:"",g=b.selectedDay(c,f);b.options.onSelected.call(this,"date",g,a(this).data(o)),b.$trigger&&b.hide("date",g,a(this).data(o))}).on("click","["+m+"]",function(){var a=Number(b.$disMonth.html()),d=parseInt(this.innerHTML);b.updateDateView(a,d),c("date",a,d),b.options.onSelected.call(this,"month",new Date(a,d-1))}),b.$element.on("mouseenter","["+l+"]",function(c){var d=b.getDisDateValue(),e=new Date(d[0],d[1]-1,parseInt(this.innerHTML));b.hasLabel&&a(this).data(o)&&(a("body").append(b.$label),b.showLabel(c,"date",e,a(this).data(o))),b.options.onMouseenter.call(this,"date",e,a(this).data(o))}).on("mouseleave","["+l+"]",function(){b.$label.hide()})},resize:function(){var a=this.width,b=this.height,c=this.$element.find(".calendar-hd").outerHeight();this.$element.width(a).height(b+c).find(".calendar-inner, .view").css("width",a+"px"),this.$element.find(".calendar-ct").width(a).height(b)},init:function(){this.fillStatic(),this.resize(),this.render(),this.view=this.options.view,this.setView(this.view),this.event()},setData:function(a){if(this.data=a,"date"===this.view){var b=this.getDisDateValue();this.fillDateItems(b[0],b[1])}else"month"===this.view&&this.updateMonthView(this.$disMonth.html())},methods:function(a,b){return"[object Function]"===B.call(this[a])?this[a].apply(this,b):void 0}},a.fn.calendar=function(b){var d,f=this.data("calendar"),g=[].slice.call(arguments);return f?c(b)?(d=b,g.shift(),f.methods(d,g)):this:this.each(function(){return a(this).data("calendar",new e(this,b))})},a.fn.calendar.defaults=f});