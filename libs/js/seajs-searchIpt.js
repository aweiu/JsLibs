/*! 作者:阿伟 */
/*! git:https://github.com/328080339/JsLibs.git */
/*! 推荐sealoader模块加载器:https://www.npmjs.com/package/sealoader */
/*! 最后修改于 2016-04-06 15:39:04 */
define(function(require,exports,module){var httpClient=require("seajs-httpClient");httpClient.showWaitting=!1;var config,ipt,searchRecord={},requestCount=0,timer,searchRecord_max=20,searchRecordNum=0,searchRecord_cacheKey;exports["int"]=function(a){config=a,ipt=config.iptNode||document.getElementById(config.iptId),ipt.addEventListener("input",function(){timer&&clearTimeout(timer);var a=this.value.replace(/\s/g,"");""!=a&&(config.filter&&!config.filter(a)||(timer=setTimeout(function(){search(a)},300)))})},exports.setConfig=function(a,b){config[a]=b};var draw=function(a){a&&config.draw(a)},search=function(key){var code=++requestCount,url=config.url,parameters=config.parameters;parameters?"function"==typeof parameters&&(parameters=config.parameters()):parameters=config.searchKey+"="+key,url+=(-1!=config.url.indexOf("?")?"&":"?")+parameters;var httpCallBac=function(rs){null!=rs&&(searchRecord[url]=rs,code==requestCount&&draw(config.dataKey?eval("rs."+config.dataKey):rs))},searchRecordRs=searchRecord[url];if(null!=searchRecordRs)return void httpCallBac(searchRecordRs);if(++searchRecordNum==searchRecord_max&&delete searchRecord[searchRecord_cacheKey],searchRecord_cacheKey=url,"post"==config.method){var urlA=url.split("?");httpClient.post(urlA[0],urlA[1],httpCallBac)}else httpClient.get(url,httpCallBac)};exports.newInstance=function(fuc){return function(){if(fuc+="",-1==fuc.indexOf("\nexports=this;")){fuc=("0,("+fuc+")").replace("{","{\nexports=this;");var p=/([\s;=]+require\s*\([\s\S]*?\))/g;fuc=fuc.replace(p,"$1.newInstance()"),p=/( *\. *newInstance *\( *\)){2}/g,fuc=fuc.replace(p,".newInstance()")}return new(eval(fuc))(require,exports,module)}}(arguments.callee)});